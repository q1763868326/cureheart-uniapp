(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-chat-chat"],{"3e4f":function(t,e,s){var a=s("edb9");"string"===typeof a&&(a=[[t.i,a,""]]),a.locals&&(t.exports=a.locals);var n=s("4f06").default;n("534a218d",a,!0,{sourceMap:!1,shadowMode:!1})},"45c8":function(t,e,s){"use strict";s.r(e);var a=s("d870"),n=s("bf13");for(var i in n)"default"!==i&&function(t){s.d(e,t,(function(){return n[t]}))}(i);s("c465");var o,c=s("f0c5"),u=Object(c["a"])(n["default"],a["b"],a["c"],!1,null,"572d23c2",null,!1,a["a"],o);e["default"]=u.exports},bf13:function(t,e,s){"use strict";s.r(e);var a=s("c2fc"),n=s.n(a);for(var i in a)"default"!==i&&function(t){s.d(e,t,(function(){return a[t]}))}(i);e["default"]=n.a},c2fc:function(t,e,s){"use strict";s("498a"),Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var a={data:function(){return{username_other:"",emailaddress:"",emailaddress_other:"",InputBottom:0,messagelist:[],message:"",timer:null,first:!0,count:0,start:!0}},onLoad:function(t){this.username_other=t.username_other,this.emailaddress_other=t.emailaddress_other,console.log(this.username_other),this.emailaddress=uni.getStorageSync("emailaddress"),this.getmessage()},onShow:function(){var t=this;this.timer=setInterval((function(){t.getmessage()}),1e3)},onUnload:function(){console.log("stop"),clearInterval(this.timer)},onHide:function(){console.log("stop"),clearInterval(this.timer)},onBackPress:function(){console.log("stop"),clearInterval(this.timer)},methods:{InputFocus:function(t){this.InputBottom=t.detail.height},InputBlur:function(t){this.InputBottom=0},sendmessage:function(){var t=this;""!=this.message.trim()&&uni.request({url:"http://116.62.47.156/sendmessage/",method:"POST",data:{from:this.emailaddress,to:this.emailaddress_other,content:this.message,date:(new Date).getTime()},success:function(e){"ok"==e.data&&(t.getmessage(),t.start=!0)}})},closeInterval:function(){clearInterval(this.timer)},getmessage:function(){var t=this,e=this;this.start?uni.request({url:"http://116.62.47.156/getmessage/",method:"POST",data:{from:this.emailaddress,to:this.emailaddress_other},success:function(e){var s=!1;e.data["data"].length>t.messagelist.length?(s=!0,t.count=0):(s=!1,t.count+=1,t.count>60&&(t.start=!1,t.count=0)),t.messagelist=e.data["data"],s&&(console.log("update"),t.gotobuttom())},fail:function(){},complete:function(){}}):(this.count+=1,this.count>30&&(this.start=!0,this.count=0)),e.first&&(console.log("first"),e.gotobuttom(),e.first=!1)},gotobuttom:function(){this.message="",document.getElementById("bottom").scrollIntoView()}}};e.default=a},c465:function(t,e,s){"use strict";var a=s("3e4f"),n=s.n(a);n.a},d870:function(t,e,s){"use strict";var a,n=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("v-uni-view",[s("cu-custom",{attrs:{bgColor:"bg-gradual-pink",isBack:!0}},[s("template",{attrs:{slot:"backText"},on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.closeInterval.apply(void 0,arguments)}},slot:"backText"},[t._v("返回")]),s("template",{attrs:{slot:"content"},slot:"content"},[t._v(t._s(t.username_other))])],2),s("v-uni-view",{ref:"chatlist",staticClass:"cu-chat chatpage"},t._l(t.messagelist,(function(e,a){return s("v-uni-view",{key:a,class:e["from"]==t.emailaddress?"cu-item self":"cu-item"},[e["from"]!=t.emailaddress?s("v-uni-view",{staticClass:"cu-avatar radius",staticStyle:{"background-image":"url(https://ossweb-img.qq.com/images/lol/web201310/skin/big107000.jpg)"}}):t._e(),s("v-uni-view",{staticClass:"main"},[s("v-uni-view",{staticClass:"content shadow",staticStyle:{"word-wrap":"break-word","word-break":"normal",display:"flex"}},[s("v-uni-text",[t._v(t._s(e["content"]))])],1)],1),e["from"]==t.emailaddress?s("v-uni-view",{staticClass:"cu-avatar radius",staticStyle:{"background-image":"url(https://ossweb-img.qq.com/images/lol/web201310/skin/big107000.jpg)"}}):t._e(),s("v-uni-view",{staticClass:"date"},[t._v(t._s(e["date"]))])],1)})),1),s("v-uni-view",{staticClass:"cu-bar foot input",style:[{bottom:t.InputBottom+"px"}]},[s("v-uni-view",{staticClass:"action"},[s("v-uni-text",{staticClass:"cuIcon-sound text-grey"})],1),s("v-uni-input",{staticClass:"solid-bottom",attrs:{"adjust-position":!1,focus:!1,maxlength:"300","cursor-spacing":"10"},on:{focus:function(e){arguments[0]=e=t.$handleEvent(e),t.InputFocus.apply(void 0,arguments)},blur:function(e){arguments[0]=e=t.$handleEvent(e),t.InputBlur.apply(void 0,arguments)},confirm:function(e){arguments[0]=e=t.$handleEvent(e),t.sendmessage.apply(void 0,arguments)}},model:{value:t.message,callback:function(e){t.message=e},expression:"message"}}),s("v-uni-view",{staticClass:"action"},[s("v-uni-text",{staticClass:"cuIcon-emojifill text-grey"})],1),s("v-uni-button",{staticClass:"cu-btn bg-green shadow",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.sendmessage.apply(void 0,arguments)}}},[t._v("send")])],1),s("v-uni-view",{attrs:{id:"bottom"}})],1)},i=[];s.d(e,"b",(function(){return n})),s.d(e,"c",(function(){return i})),s.d(e,"a",(function(){return a}))},edb9:function(t,e,s){var a=s("24fb");e=a(!1),e.push([t.i,".chatpage[data-v-572d23c2]{padding-bottom:%?100?%}#bottom[data-v-572d23c2]{width:100%;height:%?90?%;margin-top:%?90?%}",""]),t.exports=e}}]);